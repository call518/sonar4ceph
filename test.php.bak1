<html>
<title> System Stats </title>
<head>
<script type="text/JavaScript">

function timedRefresh(timeoutPeriod) {
	setTimeout("location.reload(true);",timeoutPeriod);
}

</script>
</head>

<body onload="JavaScript:timedRefresh(5000);">
<?php
/* Here I am setting  up the variables for the commands to pass down through to the shell */

$date = (shell_exec("date"));
echo "<pre><font color=black>$date</font></pre>";

$file = shell_exec('ceph osd tree --format=json');
$input_json = json_decode($file);
$nodes = array();

foreach ( $input_json->nodes as $node )
{
	$nodes[$node->id] = $node;
}

function buildNode($nodeID) {
	global $nodes;

	$return = array(
		"name" => $nodes[$nodeID]->name,
		"status" => $nodes[$nodeID]->status,
		"type" => $nodes[$nodeID]->type,
		"children" => array()
	);

	if (count($nodes[$nodeID]->children)) {
		foreach ($nodes[$nodeID]->children as $child) {
			$return['children'][] = buildNode($child);
		}
	}

	return $return;
}

$nodeTree = buildNode(-1);

#$output = json_encode($nodeTree);
#var_dump($output);

getChildren($nodeTree);


######################################
## Functions
######################################
function getChildren($arr) {
	#var_dump(rsort($arr));
	$name = $arr[name];
	$status = $arr[status];
	$type = $arr[type];
	echo "<pre><font color=black>name: $name</font></pre>";
	echo "<pre><font color=black>status: $status</font></pre>";
	echo "<pre><font color=black>type: $type</font></pre>";
	$children = $arr[children];
	if (count($children) > 0) {
		foreach ($children as $item) {
			getChildren($item);
		}
	}
}
######################################


?>

</body>
</html>
